% !TEX root = ../main.tex
\section{Introductory Remarks}

Ethereum-compatible blockchain environments, called Layer 2s (or \layertwos), have demonstrated an ability to reduce transaction fees by 99--99.9\% while preserving the strong guarantees of integrity and availability in the underlying blockchain. The subject of this paper concerns one sub-category of \layertwo technology called an optimistic rollup. The website \textit{L2 Beat} attempts to capitalize all tokens of known value across the top 25 \layertwo projects, and finds that two optimistic rollups, \arb and \opt, respectively account for 50\% and 30\% of \layertwo value---\$4B~USD at the time of writing.\footnote{\href{https://l2beat.com/scaling/tvl/}{L2 Beat}, accessed Oct. 2022.}

We will describe the working details of optimistic rollups later in this paper but here are the main takeaways. Currently, rollups are faster and cheaper than Ethereum itself, however each \layertwo is essentially an isolated environment that cannot instantly and trustlessly interact with accounts and contracts that are running on either \layerone or other \layertwos. An optimistic rollup project will typically provide a smart contract, called a validating bridge~\cite{mccorry2021sok}, that can trustlessly move ETH (and other tokens and even arbitrary messages) between \layerone and its own \layertwo. It does this by locking the ETH in the \layerone contract and later releasing it, on request, according to who its new owner is on \layertwo at the time of the request. If finalized, the ETH will be destroyed on \layertwo and will be released by the bridge on \layerone.

Owing to how optimistic rollups convince the \layerone bridge contract of who the current owner of withdrawn ETH is on \layertwo (explained below), the bridge has to first wait a period of time called the dispute window. The current default is 7 days in \arb and \opt, however the filing of new disputes can extend the window. The bottom line is that users have to wait at least 7 days to draw down ETH from an optimistic rollup. 

\paragraph{Contributions.} In this paper, we compare several methods---atomic swaps and tradable exits---for working around this limitation. While we argue workarounds cannot be done generally, some circumstances allow it: namely, when the withdrawn token is liquid, fungible, and available on \layerone and the withdrawer is willing to pay a fee to speed up the withdraw. We concentrate in the task of drawing down ETH specifically but the solution works for any fungible ERC20 (or related) token. While these techniques work easily between human participates that have off-chain knowledge, such as the valid state of the \layertwo, it is harder to make them compatible with \layerone smart contracts that have no ability to validate the state of \layertwo. We propose a solution using tradable exits and prediction markets to enable an \layerone smart contract to safely accept withdrawn tokens before the dispute period is over. Finally, we modify the current version, \nitro, of the most popular optimistic rollup, \arb, made open source\footnote{\href{https://}{GitHub: Nitro}} by \offchain to implement our solution and provide measurements. \arb is a commercial product with academic origins~\cite{kalodner2018arbitrum}.
 
% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Background} 

\paragraph{Inbox.} Roll-ups have emerged as a workable approach to reducing fees and latency for Ethereum-based decentralized applications. In a roll-up,  transactions to be executed on \layertwo are recorded in an \layerone smart contract called the inbox. Depending on the system, users might submit to the inbox directly, or they might submit to an offchain service, called a sequencer, that will batch together transactions from many users and pay the \layerone fees for depositing them in the inbox. Transactions recorded in the inbox (as \texttt{calldata}) are not executed on Ethereum. Instead, they are executed in a separate environment off the Ethereum chain, called \layertwo. This external environment will operate by different rules designed to reduce fees, increase throughput, and decrease latency. 

\paragraph{Outbox.} Occasionally (\eg every 30 minutes), validators on \layertwo will produce a checkpoint of the state of all contracts and accounts in the complete \layertwo according to the latest transactions and will place this asserted state in a contract on \layerone called the outbox. Note that anyone with a view of \layerone can validate that the sequence of transactions recorded in the inbox produces the asserted checkpoint in the outbox, however asking Ethereum to validate this be equivalent to running the transactions on Ethereum. The key breakthrough is that the assertion will be posted with \textit{evidence} that the checkpoint is correct.

\paragraph{Optimistic vs. zk-rollups.} In practice, two main types of evidence are used. In zk-rollups,\footnote{zk stands for zero-knowledge, a slight misnomer: succinct arguments of knowledge that only need to be complete and sound, not zero-knowledge, are used.} a succinct computational argument that the assertion is correct is posted and can be checked by Ethereum for far less cost than running all of the transactions. However the proof is expensive to produce. In optimistic rollups, the assertions are backed by a large amount of cryptocurrency (acting as a fidelity bond). The correctness of the assertion can be disputed by anyone on Ethereum and Ethereum itself can decide between two (or more) disputes for far less cost than running all of the transactions. It will then reallocate the fidelity bonds to the whoever is making correct assertions. If an assertion is undisputed for a window of time (\eg 7 days), the assertion is considered final.

\paragraph{Bridge.} A final piece of layer 2 infrastructure is a bridge, which can move ETH, tokens, NFTs, and even arbitrary messages, between layer 1 and layer 2. In this paper, we consider the case of a bridge for ETH (while discussing other kinds much later in Section~\ref{}). If Alice has ETH on Ethereum, she can submit her ETH to a bridge smart contract on Ethereum which will lock the ETH inside of it, while generating the same amount of ETH in Alice's account inside the layer 2 environment. Since any deviation from this will result in  an incorrect checkpoint which is ultimately checkable by Ethereum, the bridge does not need to be trusted. A set of transactions on layer 2 might see the ETH move from Alice's account to Bob's account on Layer 2. Bob is now entitled to draw down from layer 2 to layer 1. He submits a withdraw request, which reduces his Layer 2 balance and ends up in the next asserted checkpoint on Layer 1. Optimistically, the checkpoint is undisputed and 7 days later it is finalized. Bob can now ask the bridge to release the ETH by demonstrating his withdraw is contained in the finalized checkpoint.

\subsection{Related Work} 

Arbitrum is described at \textit{USENIX Security}~\cite{kalodner2018arbitrum}. Gudgeon \etal provide a systemization of knowledge (SoK) of Layer 2 technology (that largely predates rollups)~\cite{gudgeon2019sok}, while McCorry \etal provide an SoK that covers roll-ups and validating bridges~\cite{mccorry2021sok}. Some papers implement research solutions on Arbitrum for improved performance:  decentralized order books~\cite{moosavi2021lissy} and secure multiparty computation~\cite{demirag2021absentia}. Further academic work on optimistic rollups and bridges is largely missing at this time, but we anticipate it will become an important research area.  Other related topics are atomic swaps and prediction markets. Too many papers propose atomic swap protocols to list here but see Zamyatin \etal for an SoK of the area (and a new theoretical result)~\cite{zamyatin2021sok}. Decentralized prediction markets proposals predate Ethereum and include Clark \etal~\cite{clark2014decentralizing} and Truthcoin~\cite{sztorc2015truthcoin}. Early Ethereum projects Augur and Gnosis began as prediction markets. 

The idea of tradable exits predates our work. It is hard to pinpoint a source but it is discussed: \textblue{examples}. In this paper, we do a comparative analysis of tradeable tickets with other approaches (atomic swaps), actually implement it, and suggest parameters. Further, our hedging protocol with prediction markets is, to our knowledge, novel.

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Proposed Solution} 

For simplicity, we will describe a fast exit system for ETH but it is designed for any fungible token native to \layerone, available for exchange on \layerone. Consider an amount of 100 ETH. When this amount is in the user's account on \layerone, we use the notation 100 \ethone. When it is in the bridge on \layerone and in the user's account on \layertwo, we denote it 100 \ethtwo. When the ETH has been withdrawn on \layertwo and the withdrawal has been asserted in the \layerone outbox, but the dispute window is still open, we refer to it as 100 \ethxx. Other transitionary states are possible but not needed for our purposes.

\subsection{Design Landscape}

\begin{table}[t]
    \renewcommand{\arraystretch}{1.3}
    \centering
    
    \begin{tabular*}{0.9\textwidth}{@{\extracolsep{\fill}} llccccccccccccc}
    
    \textit{Type} &
    \textit{Example} & 
    \headrow{No trusted third party} & 
    \headrow{Within a \layerone transaction} &
    \headrow{Within a \layertwo rollup} &  
    \headrow{No griefing} &
    \headrow{No free option} & 
    \headrow{No super dealers} & 
    \headrow{	} & 
    \headrow{	} \\ \hline 
    
    Normal Exit (baseline)   	& Arbitrum		&\full	&	&	&\full	&\full	&\full	&	&	\\ \hline
    Centralized   			& Coinbase	&	&\full	&\full	&\full	&\full	&\full	&	&	\\
    HTLC Swaps 			& Celer		&\full	&\prt	&\full	&	&	&	&	&	\\
    Conditional Transfers	& StarkEx		&\full	&\full	&\full	&	&	&	&	&	\\ % data quality
    Bridge Tokens 		& Hop 		&\prt	&\prt	&\full	&	&\full	&	&	&	\\ 
    Tradeable Exits  		& This Work	&\full	& 	&\full	&\full	&\full	&	&	&	\\ 
    Hedged Tradeable Exits  	& This Work	&\full	& 	&\full	&\full	&\full	&\full	&	&	\\ \hline
                                                                                        
    \end{tabular*}
    
\caption{Comparing alternatives for faster withdrawals where \full~satisfies the property fully, \prt~partially satisfies the property, and no dot means the property is not satisfied.\label{tab:landscape}}

\end{table}

\paragraph{Centralized.} Consider Alice who has 100 \ethtwo and wants 99.95 \ethone for it (or an amount close to that). We describe a set of solutions for Alice. If we admit a centralized trusted party, such as an exchange (\eg \textit{Coinbase}, \textit{Binance}), then a market for \ethtwo/\ethone can be established with liquidity on both sides. Liquidity might come from a decentralized set of providers, but relaying the outcome of a \layertwo action to \layerone requires a trusted entity. This entity can be distributed to an established set of trustees (called proof of authority) but is not decentralized (\ie not a large, \textit{open} set of participants).  

\paragraph{Atomic Swap.} Assume Bob has 99.95 \ethone and is willing to swap with Alice. An atomic swap binds together (i) an \layertwo transaction moving 100 \ethtwo from Alice to Bob and (ii) a \layerone transaction moving 99.95 \ethone from Bob to Alice. By binding, we mean either both execute or both fail. A hash-timelocked-contract (HTLC) is a standard way of achieving this that works between Ethereum and an EVM-based \layertwo. Its main drawback is that it also has a time window where Alice (assuming she is the first mover in the protocol) must wait on Bob, who might abort causing Alice's \ethtwo to be locked up while waiting (called griefing). Bob also needs to monitor both chains so he cannot be a smart contract. 
% Example CELR cBridge

\paragraph{Conditional Transfers.} Alice uses a \layerone contract to register a request for payment of 99.95 \ethone (from anyone) with ID number 1337. On \layertwo,  she provides Bob with a signed conditional transaction that withdraws 100 \ethtwo to Bob (in 7 days) \textit{if and only if} a payment has been made on \layerone in the registry (otherwise it becomes invalid after one hour). A more powerful rollup can check the \layerone contract state before deciding to include the \layertwo transaction or not. As in atomic swaps, Bob needs to monitor \layertwo for the conditional transaction before deciding to act on \layerone and submit payment. Also like atomic swaps, Bob can grief Alice.
% Race conditions if Alice can cancel (and if she can't, infinite grief???)

% https://medium.com/starkware/conditional-transfers-the-key-to-interoperability-2e1de044fb65		X
% https://medium.com/starkware/starkexchange-fast-withdrawals-using-cookie-jars-88eefea6a11a	X
% https://docs.starkware.co/starkex/conditional-transfer.html								X


\paragraph{Bridge Token.} Hop
% https://medium.com/onther-tech/cross-rollup-transfer-hop-protocol-2c10ea041e23
% https://hop.exchange/whitepaper.pdf

\paragraph{Tradeable Exits.} If Alice and Bob withdraws 100 \ethtwo on \layertwo, which (like all \layertwo transactions) is recorded in the \layerone inbox. Bob can agree  results is eventually included in an \rblock 


\paragraph{Hedged Tradeable Exits.} Our solution ...

 

\begin{itemize}
\item Landscape: atomic swaps
\item Landscape: Change the bridge instead of using a third party contract (reason: too late once you withdrawal)
\end{itemize}

\subsection{Design Landscape}


\subsection{Fast Bridge} 

\begin{itemize}
\item Allow trading of exits (atomic unit) -> track most recent owner (constant time) in outbox. Authorization (only current owner can transfer) -> on execute, check for current owner. 
\item Self-insurance (staking a fidelity bond) (you need liquidity) 
\item Prediction market: someone else will insure it (better than insurance because you can exit quickly, change your mind, make money on over-/under- without necessarily agreeing with the position you are buying
\end{itemize}

\subsection{Prediction Market}

In our protocol so far, Alice wants to fast withdraw 100 \ethtwo. Bob has 100 \ethone that he will not use until after the dispute window. Bob also runs an \layertwo validator so he is assured that if Alice withdraws, it is valid and will eventually finalize. In this case, Alice will withdraw 100 \ethxx and swap it for Bob's 100 \ethone, while paying a fee to Bob. 

One remaining issue with this method is how specialized Bob is: he must have liquidity in \ethone, be an active trader who knows how to price futures, and be an \layertwo validator. While we can expect blockchain participants with each specialization, it is a lot to assume of a single entity. The goal of this subsection is to split Bob into two distinct participants: one that has \ethone liquidity but does not know about \layertwo (Carol) and one that knows about \layertwo but is not necessarily an active trader on \layerone (David). The main impact of this change is that Carol can be an autonomous \layerone smart contract. Carol might be an intermediary that exchanges \ethxx and \ethone. Alternatively, recall that Alice wants \ethone quicky in order to do something on \layerone with it; Carol can be that destination account or contract.

What is the risk if Carol just accepts \ethxx as if it were \ethone? Carol can check, using \layerone only, that Alice owns \ethxx within a disputable assertion that is registered in the \layerone outbox of the rollup. The risk is that the assertion is wrong and is not finalized. 


\subsection{Implementation} 

The solution is made up of four components: (1) tradeable exits, (2) a prediction market to hedge the exit, and (3) a market to trade hedged (or unhedged) \ethxx. We implement (1) in \arb \nitro. For (2), one can use an existing decentralized prediction market (\eg \textit{Augur} or \textit{Gnosis}) however we further modify \arb \nitro to make it friendly to a prediction market that wants to learn the status of an \rblock (pending, confirmed, slashed). For (3), one can again use an existing market \textblue{but we make \ethxx friendly to external markets by realizing an ERC20 interface}. That said, \ethxx does not compose will with automated market makers (\eg \textit{Uniswap}), the predominate DeFi exchange (see Section~\ref{sec:uniswap}), so we also implement a basic offer contract for selling \ethxx.


\begin{itemize}
\item Arbitrum's Nitro. Bridge: inbox, sequencer, outbox.
\item Implemented a market, following is the gas cost related to the market:
gasUsed for opening a market on an exit: 328,029
gasUsed for transferring the exit to the market:  86,701 (it was the first transfer so a bit more expensive that the 2nd, 3rd,.. see below)
Gas cost for submitting the Bid for when the Bid is greater than ask -> trade occurs and settles in one single submitBid tx:  105,287
Gas cost for execution is: 92,148
\item Modify outbox to allow tradeable exits
\item Modify the Nitro codebase (arbnode and validator) to shrink the fraud proof window from 7 days to 1 minute: (1) Modify the confirmPeriod variable in the arbnode/node.go file, (2) modify the MakeAssertionInterval variable validator/staker.go
\item To make the bridge prediction market friendly: 
Modify the outbox: (1) added a Mapping that maps the proposed arbitrum block number (also known as assertion and node) to the pending state. (2) added a function which accepts a proposed block number and adds it to the pending assertions mapping.
Modify the rollupcore: The validator acts through the RollupCore.sol contract when making an assertion by calling a createNewNode() function. We modifies this function so that every time a node is created by the validator it's also added to the outbox's pending assertions mapping (outbox.addToPendingAssertions(latestNodeCreated()))

\item L1 gas costs: new function (transferSpender) : 
First Transfer: 
1) Alice withdraws ETH from L2
2) She transfers her exit to Bob
transferSpender in this case costs : gasUsed : 85,945
Second Transfer: 
2) Now Bob transfer his exit to Carol
transferSpender in this case costs : gasUsed : 48,810
Third Transfer:
2) Now Carol transfer his exit to Nancy
transferSpender in this case costs : gasUsed : 48,798

 (difference of two mappings)

\item L1 gas costs: execute the exit: 91,418

\item Unit tests: say something
\item What happens when an assertion fails? (pro: ticket fails with assertion, better for prediction markets (betting on assertion which is a batch of exits); ticket passes even if assertion fails, sounds better (caveat: probably won't happen)
\item Challenges: SDK, where to change, unit test failed assertions (good assertion, bad assertion where withdrawal is ok, bad assertion where the withdrawal is problematic)
\item Expose assertion failures/successes to external contract (submit ID for assertion, get back status: pending, finalized, or discarded). Write down the SDK call. (what happens to a failed assertions???)
\end{itemize}


% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Discussion}

\subsection{Pricing} 

\paragraph{Pricing \fail.}

Consider how much you would sell 100 \fail for. As an expected value, it is the product of the payout ($P_0$) and the probability that the \rblock fails to finalize. However the trader is informed because they have run verification software and checked that the \rblock validates. Let $D$ be the ``delivery'' cost of \fail---which in our case is the cost of production and transfer in \layerone gas, which on Ethereum is a fixed cost, invariant to the number of shares. The valuation is:

\[ P_0 \cdot \mathbf{Pr}[ \mathrm{\mathsf{rblock}~fails~to~finalize} |  \mathrm{\mathsf{rblock}~passes~software~verification} ] + D. \]

\paragraph{Working Example.} The promise of an optimistic rollup is that it is very costly to post an \rblock that will not finalize. Assume the probability an \rblock fails for any reason is 1 in a billion. Assume the probability of inattention---that no one challenges a bad \rblock---is 1 in a million. Assume the validation software is wrong (false positive) also with 1 in a million. Using Bayes theorem, the price is $(100 \mathrm{~ETH})\cdot10^{-15}$; a near-zero price for 100 \fail. Thus the cost will be dominated by $D$. Assume it is $0.006$ ETH to generate shares and $0.002$ ETH to transfer shares, for a total of $0.008$ ETH. This is an upperbound for 100 \fail, assuming they are created as a batch. If they are from an even larger batch of shares, the price could be cheaper (\ie economies of scale).

% Final 99%
%	Valid 99%
%	Invalid 1%		No one paying attention => 1 in a million
% Fail 01% 		Pr[fails] => 1 in a billion
%	Valid 1%		Fuzzing => 1 in a million
%	Invalid 99% 	

% Fail & Valid: 1 in a billion * 1 in a million		10^-15
% Final & Valid: (1 - 1 in a billion) (1 - 1 in a milion)	0.999998999000001
% Fail | Valid: 

\paragraph{Pricing \ethxx.}

Next consider how much you would pay for 100 \ethxx (finalized in 7 days = 168 hours) in \ethone today. Since \ethxx is less flexible than \ethone, it is likely that you do not prefer it to \ethone, so our intuition is that it should be priced less (\eg 100 \ethxx = 99 \ethone). However our solution works for any pricing and we can even contrive corner cases where \ethxx might be worth more than \ethone by understanding the factors underlying the price. 

In traditional finance~\cite{Hull}, forward contracts (and futures, which are standardized, exchange traded forwards) are very similar to \ethxx in that they price today the delivery of an asset or commodity at some future date. One key difference is that with a forward contract, the price is decided today but the actual money is exchanged for the asset at delivery time. When \ethxx is sold for \ethone, both price determination and the exchange happen today, while the delivery of \ethone for \ethxx happens in the future. The consequence is that we can adapt pricing equations for forwards/futures however the signs (positive/negative) of certain terms need to be inverted. 

We review the factors~\cite{Hull} that determine the price of a forward contract ($F_0$) and translate what they mean for \ethxx:

\begin{itemize}
\item \textit{Spot price of \ethone ($S_0$):} the price today of what will be delivered in the future. \ethxx is the future delivery of \ethone, which is by definition worth 100 \ethone today. 
\item \textit{Settlement time ($\Delta t$):} the time until the exit can be traded for \ethone. In \arb, the time depends on whether disputes happen. We simplify by assuming $\Delta t$ is always 7 days (168 hours) from the assertion time. A known fact about forwards is that $F_0$ and $S_0$ converge as $\Delta t$ approaches 0. 
\item \textit{Storage cost ($U$):} most relevant for commodities, receiving delivery of a commodity at a future date relieves the buyer of paying to store it in the short-term. Securing \ethxx and securing \ethone is identical in normal circumstances, so not having to take possession of \ethone for $\Delta t$ time does not reduce costs for a \ethxx holder. 
\item \textit{Delivery cost ($D$):} the cost of delivery of the asset, which in our case will encompass gas costs. Exchanging \ethone for \ethxx requires a transaction fee and also creates a future transaction fee to process the exit (comparable in cost to purchasing a token from an automated market maker). An \ethone seller should be compensated for these costs in the price of \ethxx.
\item \textit{Exchange rate risk:} a relevant factor when the asset being delivered is different than the asset paying for the forward. In our case, we are determining the price in \ethone for future delivery of \ethone; thus there is no exchange risk at this level of the transaction. However the price of gas (in the term $D$) is subject to ETH/gas exchange rates. For simplicity, we assume this is built into $D$.
\item \textit{Interest / Yield ($-r+y$):} both \ethone and \ethxx have the potential to earn interest or yield (compounding over $\Delta t$), while for other tokens, there might be an opportunity to earn new tokens simply by holding the token. Let $r$ be the (risk free) interest (yield) rate for \ethone that cannot be earned by \ethxx, while $y$ is the opposite: yield earned from \ethxx and not \ethone. Initially $y>1$ and $r=0$ however with \ethxx becoming mainstream, it is possible $r=y$ (especially hedged \ethxx). 
\item \textit{Settlement risk:} the risk that \ethone will fail to be delivered for \ethxx discounts the price of \ethxx, but we treat this as zero when \ethxx is hedged with prediction market shares. 

\end{itemize}

Put together, the price of \ethxx ($F_0$) is: \[ F_0 = (S_0 + U - D)\cdot e^{(-r+y)\cdot\Delta t} \]

\paragraph{Working Example.} Alice starts with 100 \ethxx. She purchases 100 \fail for $0.008$ ETH to hedge the \ethxx. She deposits 100 \ethxx and 100 \fail into a smart contract. How much should her account be credited for (in \ethone)? Smart contracts can hold deposits with no cost ($U=0$). Alice pays the transaction fee for the deposit, however the cost for the contract for exiting \ethxx into \ethone after the dispute period is expected to be $D=0.008$ ETH ($D$) (and if the \rblock fails, the cost of redeeming \fail is the same). Assume a safe-ish annual percent yield (APY) on ETH deposits is 0.2\%. Assume \ethxx expires in 6 days (0.0164 years). \ethxx earns no yield ($y=0$). Plugging this into the equation, $F_0=99.665$ ETH.

Next, consider a smaller amount like 0.05 \ethxx (less than \$100 USD at time of writing). Now the gas costs are more dominate. $F_0=0.04186$ ETH and \fail still costs $0.008$ ETH. Alice ends up with 0.03386 \ethone which is only 67.7\%. This demonstrates that fast exits are expensive for withdrawals of amounts in the hundreds of dollars.

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\subsection{Where to Solve Problem? }
\begin{itemize}
\item Exit to a third party collateral contract, implements trading
\end{itemize}

\subsection{Withdrawal Format }
\begin{itemize}
\item Divisible exits
\item ERC20 / ERC721? -> allowances or not? 
\end{itemize}

\subsection{Non-Substitutable Withdrawals}

\begin{itemize}
\item Illiquid tokens 
\item NFTs (substitute for ETH -> support)
\item Messages (oracle updates, read calls, any L2-to-L1 message...) (still offer insurance)
\end{itemize}

\subsection{Assertion Failures}

\begin{itemize}
\item does exit go away with the assertion or not? Pros/cons
\end{itemize}

\subsection{Markets}
\label{sec:uniswap}

\begin{itemize}
\item Can't use an AMM 
\item Can't run out
\item Simple auction
\item Divisible exits
\item Exit pools
\end{itemize}




% Pr [finalize | valid]
% Pr [finalize] high b/c you will get slashed
% Pr [valid] higher than below (Pr [valid | fin] + Pr [valid | !fin])
% Pr [valid | finalize] 0.99999999%


% Pr [ valid ] - Pr[valid | finalize] -> bigger -> lower probability (false positive)
% Pr [valid ] - Pr[finalize] -> bigger -> lower probability (false positive) 

% 1 in a million rblocks fail
% 1 in a thousand failing blocks will validate 

% Pr[fail] = 0.00001 (low b/c you will get slashed) 
%Pr[validate | fail] =  0.001   (coding mistake; false negative) 
%Pr[]


%Alice needs oil in 60 days. She can buy oil today but she must store it at some, say fixed, cost $U$. Further she must spend the money today and cannot earn interest ($r$) on the money in the meantime (but she could earn yield $y$ on the oil). By buying today, she avoids the risk $k$ that delivery is delayed or breached.


% are the factors that impact this price? 

% Net present value = expected value - carrying cost - forgone interest + expected appreciation - risk (exchange) 
% How much ETH do you pay for 100 ETH in 7 days?  100 ETH - forgone interest - expected appreciation + seven day carrying cost - risk
% F_0 (forward price = variable) = (S_0  (spot price, 100 ETH) - I (cash flow which is zero) + U (carrying costs) + delivery cost (gas for ticket) ) * e^{(r-q-k)T} (interest rate - yield - risk times expiration time)
% F_0 <? Expected future price = 100 ETH -> backwardation (pay less for ETH in 7 days than you will pay now) -> storage costs are negligible -> extreme backwardation is negative oil futures (oil has cost today, buy futures is negative)
% Carol wants 100 ETH_L1 in seven days
% intuition says sell at a discount 100 ETH_L1 = 99.9 ETH_XX (called normal backwardation) however it doesn't matter -> we don't assume this
% backwardation -> people are time-sensitive
% exit in gas, swap in gas: slightly more 
% risk factor -> hedge it out with PM share
% carrying costs -> negligible (equivalent) 
% forgone interest
% yield 




